# Тесты D&D MUD

Этот каталог содержит тесты для проекта D&D MUD.

## Структура тестов

### Основные тесты

- **`test_main.py`** - Тесты точки входа в приложение и главного цикла
- **`test_main_menu.py`** - Тесты главного меню игры
- **`test_character_creation.py`** - Тесты меню создания персонажа
- **`test_character_manager.py`** - Тесты менеджера персонажей и репозитория
- **`test_ui_components.py`** - Тесты UI компонентов (Renderer, InputHandler)

### Конфигурация

- **`conftest.py`** - Конфигурация pytest с фикстурами и настройками

## Запуск тестов

### Запуск всех тестов
```bash
pytest
```

### Запуск с покрытием кода
```bash
pytest --cov=src --cov-report=html
```

### Запуск конкретного файла тестов
```bash
pytest tests/test_main.py
```

### Запуск с маркерами
```bash
pytest -m unit          # Только unit тесты
pytest -m integration   # Только интеграционные тесты
pytest -m ui            # Только тесты UI
```

### Запуск с детальным выводом
```bash
pytest -v
```

### Запуск с остановкой при первой ошибке
```bash
pytest -x
```

## Покрытие тестами

### Что протестировано:

✅ **Точка входа (main.py)**
- Настройка логирования
- Отображение заставки
- Обработка главного меню
- Обработка исключений
- Интеграционные потоки

✅ **Главное меню**
- Инициализация меню
- Отображение опций
- Обработка выбора пользователя
- Callback функции
- Обработка ошибок

✅ **Создание персонажа**
- Пошаговое создание
- Ввод базовой информации
- Генерация характеристик
- Выбор расы и класса
- Просмотр и подтверждение
- Отмена создания

✅ **Менеджер персонажей**
- Сохранение и загрузка
- Форматы JSON и YAML
- Singleton паттерн
- Список персонажей
- Удаление персонажей

✅ **UI компоненты**
- Очистка экрана
- Отображение заголовков и меню
- Цветовые сообщения
- Валидация ввода
- Обработка исключений

## Архитектура тестов

### Используемые паттерны:

- **Mock/Stub** - Изоляция тестируемого кода
- **Fixture** - Подготовка тестовых данных
- **AAA Pattern** - Arrange, Act, Assert
- **Test Pyramid** - Много unit тестов, меньше интеграционных

### Принципы тестирования:

- **Изолированность** - Каждый тест независим
- **Повторяемость** - Тесты дают одинаковые результаты
- **Быстрота** - Тесты выполняются быстро
- **Читаемость** - Понятные имена и структура

## Тестовые данные

Тесты используют временные директории и моки для изоляции от реальных данных. Все временные файлы автоматически удаляются после выполнения тестов.

## Расширение тестов

### Добавление нового теста:

1. Создайте файл с префиксом `test_`
2. Импортируйте необходимые модули
3. Используйте фикстуры из `conftest.py`
4. Следуйте AAA паттерну
5. Добавьте маркеры при необходимости

### Пример нового теста:

```python
def test_new_feature(mock_character, temp_dir):
    """Тестирует новую функциональность."""
    # Arrange
    test_data = setup_test_data()
    
    # Act
    result = function_under_test(test_data)
    
    # Assert
    assert result.success is True
    assert result.data == expected_data
```

## CI/CD

Тесты автоматически запускаются в CI/CD пайплайне. Новые изменения должны проходить все тесты перед слиянием.

## Отладка тестов

### Запуск с отладчиком:
```bash
pytest --pdb
```

### Остановка на первом падении:
```bash
pytest -x --pdb
```

### Показ вывода print():
```bash
pytest -s
```

## Метрики

Текущее покрытие кода: ~85%
Количество тестов: 50+
Unit тесты: 70%
Интеграционные тесты: 30%
