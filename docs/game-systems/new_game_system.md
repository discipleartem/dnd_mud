# Система меню "Новая игра" в D&D MUD

## Обзор

Обновленная система меню "Новая игра" предоставляет гибкие опции создания персонажа с автоматическим определением начального уровня из различных источников.

## Основные возможности

### 1. Подтверждение ввода имени
- При вводе имени персонажа появляется подтверждение
- Пользователь может подтвердить, изменить или отменить ввод
- Работает как в полном, так и в быстром создании

### 2. Автоматическое определение начального уровня
Система определяет начальный уровень по приоритету:
1. **Модификации** (приоритет 1) - самый высокий приоритет
2. **Приключения** (приоритет 2) 
3. **Базовая конфигурация** (приоритет 3)
4. **По умолчанию** (приоритет 999) - уровень 1

### 3. Варианты создания персонажа
- **Полное создание** - пошаговое создание с выбором всех параметров
- **Быстрое создание** - с настройками по умолчанию и автоматически определенным уровнем
- **Создание по умолчанию** - персонаж 1 уровня со стандартными характеристиками

## Структура конфигурационных файлов

### Конфигурация мода (`data/mods/{mod_name}/config.yaml`)
```yaml
name: "Название мода"
description: "Описание мода"
game_settings:
  starting_level: 10  # Уровень от мода
character_creation:
  starting_level: 15  # Альтернативный способ указания
```

### Конфигурация приключения (`data/adventures/{adventure_name}.yaml`)
```yaml
name: "Название приключения"
recommended_level: 5  # Рекомендуемый уровень
character_settings:
  starting_level: 5   # Начальный уровень для приключения
```

### Базовая конфигурация (`data/config/game_config.yaml`)
```yaml
game_settings:
  starting_level: 3
character_creation:
  default_level: 2
```

## Пример использования

### В коде
```python
from src.domain.services.level_resolver import level_resolver

# Получить начальный уровень
starting_level = level_resolver.get_starting_level()

# Получить подробную информацию
info = level_resolver.get_level_info()
print(f"Уровень: {info['final_level']}")
print(f"Источник: {info['active_source']}")
```

### В меню создания персонажа
При запуске создания персонажа система автоматически:
1. Определяет начальный уровень из всех источников
2. Показывает пользователю информацию об определении уровня
3. Предлагает изменить уровень при необходимости

## Архитектура

### LevelResolver
Основной сервис для определения начального уровня:
- `_collect_all_sources()` - собирает все источники
- `_get_level_from_mods()` - проверяет моды
- `_get_level_from_adventures()` - проверяет приключения  
- `_get_level_from_config()` - проверяет базовую конфигурацию

### CharacterCreationController
Обновленный контроллер создания персонажа:
- `create_quick_character()` - использует автоматическое определение уровня
- `create_default_character()` - создает персонажа 1 уровня

### NewGameMenu
Обновленное меню новой игры с тремя опциями создания.

## Тестирование

Запустите тест для проверки системы:
```bash
python test_level_resolver.py
```

## Расширение системы

### Добавление нового источника уровня
1. Добавьте метод в `LevelResolver` для проверки нового источника
2. Обновите `_collect_all_sources()` для включения нового источника
3. Установите соответствующий приоритет

### Поддержка новых форматов конфигурации
- Добавьте парсеры в методы `_get_level_from_*`
- Обработайте новые форматы файлов (JSON, XML и т.д.)

## Обработка ошибок

Система устойчива к ошибкам:
- Отсутствующие файлы конфигурации игнорируются
- Невалидные уровни пропускаются
- Ошибки парсинга YAML обрабатываются gracefully
- Всегда есть уровень по умолчанию (1)

## Совместимость

Система обратно совместима:
- Старые моды без конфигурации работают нормально
- Отсутствие файлов конфигурации не вызывает ошибок
- Существующий код создания персонажа продолжает работать
